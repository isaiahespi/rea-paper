---
title: "Appendix B: Sample Demographics and Balance"
format:
  bookup-html: 
    toc: true
    toc-depth: 3
    embed-resources: false
    embed-fonts: true
    link-citations: true
    smooth-scroll: true
    link-external-newwindow: true
    citations-hover: true
    footnotes-hover: false
    code-fold: show
    code-overflow: wrap
    code-tools: true
    theme: 
      light: [bookup.scss]
      dark: [bookup.scss, bookup_dark.scss]
---

## Sample Demographics

The median age was 46 (mean age was $47$), $51.7\%$ ($n = 658$) women, $47\%$ ($n = 598$) men, and approximately $1.3\%$ who identified as either Non-binary/third gender ($n = 7$) or preferred not to say ($n = 9$). A large proportion of the sample identified as White or Caucasian ($n = 975, 76.65\%$), while all other non-White respondents comprised $27.83\%$ ($n = 297$) of the sample. Those who held a graduate level degree (e.g., Master's, Doctorate, or Professional level) comprised $13\%$ of the sample; those with either degree at the Associate or Bachelor's level comprised $36.24\%$, while $22.25\%$ had some college but no degree; and $28.46\%$ had either a high school level or equivalent education or less than high school. The largest proportion of the sample identified as Democrat at $44.64\%$, followed by Republicans at $42.59\%$. The proportion of true Independents^[Independent 'leaners' were grouped into the respective party affiliation in which they lean.] was $12.78\%$.


```{r}
#| label: tbl-demog
#| tbl-cap: "Sample Demographics"
#| 

# descriptive stats of categorical variables
# best method for html document
tbl.desc <- df |>  
  labelled::set_variable_labels(
    age_4cat = "Age group",
    gender_3cat = "Gender",
    race2 = "Race/Ethnicity",
    race_wnw = "White or Non-White",
    educ_4cat = "Education",
    partyid_3cat = "Party ID",
    milrelation  = "Military Relation"
  ) |> 
  gtsummary::tbl_summary(
    by = group,
    include = c(
    age_4cat, 
    gender_3cat, 
    race2,
    race_wnw,
    educ_4cat, 
    partyid_3cat,
    milrelation),
    statistic = list(gtsummary::all_categorical()~ "{n} ({p}%)"), 
    missing = "ifany",
    missing_text = "NA") |> 
  gtsummary::add_n() |> 
  gtsummary::add_overall() |> 
  gtsummary::modify_header(label = "**Demographic**") |> 
  gtsummary::bold_labels()

gtsummary::as_kable_extra(tbl.desc, booktabs = T) |>
  kableExtra::add_footnote(
    label = "Independents do not identify nor 'lean' toward either political party") |> 
  kableExtra::kable_styling(
    font_size = 9, 
    protect_latex = T)

# gtsummary::as_gt(tbl.desc) |>  
#   gt::tab_footnote(
#     footnote = "Independents do not identify nor 'lean' toward either political party",
#     placement = "left"
#     ) |>  
#   gt::cols_align(align = 'left', columns = everything()) |> 
#   gt::tab_options(
#     table.font.size = "small",
#     data_row.padding = gt::px(1)
#   )



```

## Test of Random Assignment to Experiment Condition

@tbl-logit shows results of a logistic regression test of random assignment to the treatment group. Demographics such as age, gender, race, educational attainment, and party ID are included as predictor variables. Note that 19 missing observations were deleted. A $\chi^2(15) = 11.010$, with 15 degrees of freedom and associated p-value > 0.05 ($p = 0.75$) confirms that none of the demographic predictor variables significantly increased the log-odds---in turn, the probability---of being assigned to the treatment group.


```{r}
#| label: tbl-logit
#| tbl-cap: "Logistic Regression of Random Assignment to Treatment"


# simple logit of test of random assignment to treatment
# treatment is DV (treatment = 1, control = 0)
# demographic variables are IVs


df <- df |> 
  mutate(group.dum = dplyr::case_when(
    group == "Treatment" ~ 1,
    group == "Control" ~ 0,
    TRUE ~ NA), .after = group)

m1 <- glm(group.dum ~ age_4cat + gender_3cat + race2 + educ_4cat + partyid_3cat, 
          family = binomial(link = "logit"), data = df)


# A Chi-square of 11.01 with 15 degrees of freedom and associated p-value > 0.05 (p-value = 0.752) confirms that none of the demographic predictor variables significantly increased the probability of being assigned to the treatment group. 

logit_tab <- gtsummary::tbl_regression(
    m1, 
    intercept = T,
    label = list(
      age_4cat ~"Age", 
      gender_3cat ~ "Gender", 
      race2 ~ "Race (includes Hispanic as race)",
      educ_4cat ~ "Educational Attainment", 
      partyid_3cat ~ "Party ID")) |> 
  gtsummary::add_global_p(keep = T) |> 
  gtsummary::add_nevent(location = c("label", "level")) |>
  gtsummary::bold_p() |> 
  gtsummary::bold_labels() |>
  # gtsummary::show_header_names()
  gtsummary::modify_header(
    label = " ",
    stat_nevent = "**Treatment N**") 
# 
#   gtsummary::modify_footnote_header(
#     footnote = "Chi-Squared ($\\chi^2$) = 11.01, d.f. = 15, p = 0.75", columns = "p.value")

gtsummary::as_kable_extra(logit_tab, 
                          booktabs = T, 
                          escape = F, 
                          addtl_fmt = T) |> 
  kableExtra::footnote("Chi-Squared = 11.01, d.f. = 15, p = 0.75", escape = F) |> 
  kableExtra::kable_styling(font_size = 9)


```

